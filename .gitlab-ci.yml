# ==========================================================
# GitLab CI/CD pipeline for Train Live Timetables web app
# Deploys directly from repo root (no public folder)
# ==========================================================

stages:
  - lint
  - test
  - deploy

# ------------------------------
# 1ï¸âƒ£ LINT: Check HTML, JS, and CSS quality
# ------------------------------
lint:
  image: node:20
  stage: lint
  before_script:
    - npm install -g htmlhint stylelint eslint
  script:
    - echo "ğŸ” Linting HTML..."
    - htmlhint index.html || true
    - echo "ğŸ” Linting CSS..."
    - stylelint "**/*.css" || true
    - echo "ğŸ” Linting JavaScript..."
    - eslint js/*.js || true
  allow_failure: true
  only:
    - main
    - merge_requests

# ------------------------------
# 2ï¸âƒ£ TEST: Run headless browser tests (optional)
# ------------------------------
test:
  image: node:20
  stage: test
  before_script:
    - npm install -g jest jsdom
  script:
    - echo "âœ… Running frontend tests (if present)..."
    - echo "No tests defined yet. Skipping..."
  only:
    - main
    - merge_requests

# ------------------------------
# 3ï¸âƒ£ DEPLOY: Publish static site to GitLab Pages
# Deploys directly from repo root
# ------------------------------
pages:
  image: alpine
  stage: deploy
  script:
    - echo "ğŸš€ Deploying Train Live Timetables app..."
    # Copy all necessary files for GitLab Pages
    - cp index.html .public/index.html
    - cp -r assets .public/assets
    - cp -r js .public/js
  artifacts:
    paths:
      - .public
  only:
    - main
