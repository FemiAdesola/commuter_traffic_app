# ==========================================================
# GitLab CI/CD pipeline for Train Live Timetables web app
# Deploys directly from repo root
# ==========================================================

stages:
  - lint
  - test
  - deploy

# ------------------------------
# 1Ô∏è‚É£ LINT: Check HTML, JS, and CSS quality
# ------------------------------
lint:
  image: node:20
  stage: lint
  before_script:
    - npm install -g htmlhint stylelint eslint
  script:
    - echo "üîç Linting HTML..."
    - htmlhint index.html || true
    - echo "üîç Linting CSS..."
    - stylelint "**/*.css" || true
    - echo "üîç Linting JavaScript..."
    - eslint js/*.js || true
  allow_failure: true
  only:
    - main
    - merge_requests

# ------------------------------
# 2Ô∏è‚É£ TEST: Run headless browser tests (optional)
# ------------------------------
test:
  image: node:20
  stage: test
  before_script:
    - npm install -g jest jsdom
  script:
    - echo "Running frontend tests (if present)..."
    - echo "No tests defined yet. Skipping..."
  only:
    - main
    - merge_requests

# ------------------------------
# 3Ô∏è‚É£ DEPLOY: Publish static site to GitLab Pages from repo root
# ------------------------------
pages:
  stage: deploy
  image: alpine:latest
  script:
    - mkdir -p public
    - cp index.html public/
    - cp -r assets public/
    - cp -r js public/
  artifacts:
    paths:
      - public
  only:
    - main
